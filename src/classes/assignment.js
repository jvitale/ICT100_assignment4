class Task1 {

    #femaleNames = "Emma,Isabella,Emily,Madison,Ava,Olivia,Sophia,Abigail,Elizabeth,Chloe,Samantha,Addison,Natalie,Mia,Alexis,Alyssa,Hannah,Ashley,Ella,Sarah,Grace,Brianna,Hailey,Anna,Kayla,Lillian,Lauren,Kaylee,Allison,Savannah,Gabriella,Sofia,Avery,Riley,Julia,Leah,Aubrey,Audrey,Katherine,Morgan,Alexa,Kylie,Brooke,Kaitlyn,Evelyn,Layla,Madeline,Kimberly,Zoe,Jessica,Alexandra,Claire,Madelyn,Maria,Arianna,Jocelyn,Amelia,Angelina,Andrea,Valeria,Sophie,Rachel,Vanessa,Aaliyah,Mariah,Gabrielle,Katelyn,Ariana,Camila,Jennifer,Melanie,Gianna,Charlotte,Paige,Sara,Isabelle,Caroline,Genesis,Isabel,Mary,Zoey,Gracie,Megan,Haley,Mya,Michelle,Molly,Stephanie,Nicole,Jenna,Natalia,Sadie,Jada,Lucy,Eva,Naomi,Rebecca,Lydia,Daniela,Keira,Adriana,Lilly,Hayden,Katie,Gabriela,Amy,Angela,Melissa,Valerie,Giselle,Diana,Amanda,Kate,Laila,Kylee,Danielle,Briana,Leslie,Catherine,Liliana,Mckenzie,Jacqueline,Ashlyn,Marissa,Juliana,Shelby,Cheyenne,Angel,Miranda,Erin,Amber,Alana,Ellie,Breanna,Ana,Adrianna,Jillian,Sierra,Jayden,Alicia,Lila,Margaret,Karen,Sabrina,Stella,Annabelle,Kathryn,Delilah,Julianna,Kelsey,Carly,Mariana,Christina,Tessa,Eliana,Bianca,Jazmin,Clara,Vivian,Josephine,Scarlett,Elena,Alexia,Maggie,Laura,Nora,Ariel,Elise,Nadia,Chelsea,Lyla,Alaina,Jasmin,Leila,Caitlyn,Cassidy,Allie,Eden,Callie,Caitlin,Kendra,Karina,Kyra,Kayleigh,Kiara,Jazmine,Karla,Alina,Lola,Kyla,Kelly,Fatima,Tiffany,Kira,Mallory,Esmeralda,Alejandra,Eleanor,Angelica,Abby,Kara,Veronica,Carmen,Jamie,Valentina,Allyson,Courtney,Cecilia,Madeleine,Alison,Esther,Lindsey,Leilani,Nina,Macy,Joanna,Cassandra,Alayna,Heidi,Emerson,Madalyn,Erica,Josie,Katelynn,Camille,Savanna,Daniella,Lucia,Emely,Joselyn,Kiley,Miriam,Cynthia,Harmony,Kiera,Monica,Bethany,Cameron,Cora,Brynn,Ciara,Genevieve,Alice,Eliza,Tatiana,Erika,Ximena,Julie,Danica,Julissa,Angie,Brenda,Malia,Shayla,Fiona,Phoebe,Paola,Selena,Rebekah,Carolina,Michaela,Penelope,Anastasia,Adeline,Ruth,Sasha,Denise,Hanna,Helen,Janelle,Lizbeth,Serena,Anya,Nancy,Lindsay,Desiree,Hayley,Talia,Jane,Annie,Bridget,Celeste,Luna,Yasmin,Emilia,Annika,Estrella,Lacey,Alessandra,Willow,Nyla,Natasha,Harley,Priscilla,Claudia,Brenna,Brittany,Fernanda,Lia,Macie,Logan,Gloria,Lana,Cindy,Lilian,Alissa,Anaya,Lena,Ainsley,Sandra,Noelle,Marisol,Meredith,Lesly,Johanna,Evangeline,Juliet,Kathleen,Meghan,Athena,Rosa,Wendy,Emilee,Alanna,Elaina,Cara,Nia,Casey,Dana,Emery,Rowan,Kaitlin,Jaden,Kiana,Viviana,Norah,Lauryn,Perla,Alyson,Rachael,Shannon,Aileen,Lillie,Danika,Heather,Taryn,Tori,Francesca,Kristen,Kristina,Patricia,Anne,Skye,Kali,Lexie,Linda,Hallie,Bryanna,Quinn,Melina,Abril,Sidney,Kassandra,Elisabeth,Adalyn,Yesenia,Dylan,Isabela,Ryan,Ashlee,Daphne,Marina,Christine,Mikaela,Ingrid,Marie,Juliette,Simone,Adelaide,Krystal,Mila,Aylin,Sylvia,Clarissa,Maritza,Kirsten,Marilyn,Whitney,Janessa,Raquel,Anika,Kamila,Aria,Ayanna,Teresa,Kaleigh,Carla,Gwendolyn,Paulina,Nathalie,Tabitha,Deanna,Ada,Liana,Jenny,Cristina,Lisa,Tania,Helena,Jaqueline,Lucille,Martha,Arielle,Marlene,Elisa,Isla,Noemi,Jessie,Tara,Camilla,Irene,Carley,Lea,Sharon,Alisha,Marisa,Scarlet,Maia,Shiloh,Tiana,Kiersten,Shania,Kaia,Pamela,Ellen,Carlie,Reyna,Carolyn,Clare,Lorelei,Paula,Kasey,Regan,Alena,Angelique,Regina,Britney,Emilie,Mariam,Julianne,Greta,Kallie,Iliana,Larissa,Sonia,Mollie,Susan,Judith,Hillary,Janet,Katrina,Gia,Elsa,Stacy,Carissa,Lorena,Milagros,Luz,Leanna,Renee,Charlie,Abbie,Elsie,Elaine,Luciana,Dahlia,Belinda,Rosemary,Cecelia,Celia,Barbara,Cristal,Eileen,Rayna,Amina,Aisha,Mayra,Leyla,Zara,Aimee,Giovanna,Kelsie,Angeline,Dominique,Adrienne,Cierra,Isabell,Jacquelyn,Janae,Frances,Shyla,Annabel,Karissa,Edith,Marianna,Damaris,Deborah,Evelin,Mara,Ayana,Tamara,Abbey,Hana,Matilda,Ann,Gillian,Beatrice,Karly,Yasmine,Ashly,Kenna,Corinne,Keely,Tanya,Tianna,Salma,Theresa,Evie,Gina,Aliza,Ali,Alisa,Tess,Abagail,Joyce,Libby,Thalia,Tia,Kristin,Mattie,Gemma,Valery,Micah,Frida,Krista,Mira,Carina,Magdalena,Cassie,Mina,Shirley,Lina,Raina,Mariela,Monique,Ashleigh,Reina,Alia,Ashanti,Lara,Lilia,Justine,Leia,Maribel,Tiara,Alannah,Naima,Gretchen,Livia,Maryjane,Anabel,Emmy,Shea,Esperanza,Micaela,Selina,Donna,Shayna,Leticia,Rory,Laurel,Kathy,Riya,Diya".split(",");
    #maleNames = "Jacob,Michael,Ethan,Joshua,Daniel,Alexander,Anthony,William,Christopher,Matthew,Jayden,Andrew,Joseph,David,Noah,Aiden,James,Ryan,Logan,John,Nathan,Elijah,Gabriel,Benjamin,Jonathan,Tyler,Samuel,Nicholas,Gavin,Dylan,Brandon,Caleb,Mason,Angel,Isaac,Evan,Kevin,Jose,Isaiah,Luke,Landon,Justin,Lucas,Zachary,Robert,Aaron,Thomas,Cameron,Adrian,Owen,Jason,Julian,Wyatt,Charles,Luis,Juan,Jeremiah,Xavier,Adam,Carlos,Sebastian,Liam,Hayden,Nathaniel,Henry,Jesus,Ian,Tristan,Bryan,Sean,Cole,Alex,Eric,Brian,Jaden,Blake,Dominic,Brady,Josiah,Kyle,Colton,Eli,Miguel,Antonio,Steven,Alejandro,Riley,Richard,Timothy,Devin,Jesse,Victor,Jake,Joel,Colin,Bryce,Levi,Oliver,Oscar,Vincent,Ashton,Cody,Micah,Preston,Marcus,Patrick,Seth,Jeremy,Nolan,Ivan,Damian,Maxwell,Alan,Kenneth,Jonah,Jorge,Giovanni,Eduardo,Collin,Omar,Emmanuel,Trevor,Edward,Ricardo,Nicolas,George,Paul,Elias,Andres,Derek,Garrett,Tanner,Fernando,Cesar,Javier,Alexis,Leonardo,Francisco,Shane,Edwin,Travis,Erick,Hector,Josue,Peter,Mario,Manuel,Abraham,Damien,Spencer,Stephen,Edgar,Wesley,Shawn,Trenton,Jared,Jeffrey,Johnathan,Bradley,Roman,Brendan,Sergio,Andy,Erik,Donovan,Raymond,Avery,Andre,Martin,Marco,Jude,Calvin,Troy,Clayton,Roberto,Zane,Gregory,Rafael,Dominick,Devon,Lukas,Johnny,Ty,Pedro,Tyson,Mateo,Marcos,Ruben,Emanuel,Simon,Dillon,Myles,Colby,Jonas,Joaquin,Frank,Enrique,Quinn,Emilio,Malik,Grady,Angelo,Julio,Derrick,Raul,Fabian,Corey,Gerardo,Ezra,Armando,Allen,Theodore,Amir,Adan,Maximilian,Randy,Dustin,Luca,Phillip,Julius,Charlie,Ronald,Jakob,Brett,Trent,Silas,Keith,Trey,Darius,Jerry,Scott,Graham,Weston,Rodrigo,Pablo,Saul,Danny,Donald,Elliot,Lorenzo,Casey,Mitchell,Alberto,Rowan,Jayson,Gustavo,Chris,Ismael,Louis,Arturo,Felix,Jimmy,Tony,Reid,Abel,Zackary,Arthur,Ricky,Esteban,Mauricio,Dennis,Albert,Marvin,Mathew,Larry,Moises,Issac,Philip,Quentin,Curtis,Jameson,Everett,Darren,Elliott,Hugo,Alec,Marshall,Walter,Lance,Ali,Nickolas,Maurice,Russell,Leland,Joe,Ernesto,Desmond,Morgan,Ramon,Rocco,Douglas,Kristopher,Gary,Lawrence,Solomon,Shaun,Alvin,Eddie,Zachariah,Dorian,Titus,Isiah,Milo,Byron,Jasper,Jonathon,Chad,Marc,Sam,Cory,Deandre,Roger,Quinton,Romeo,Franklin,Noel,Guillermo,Damon,Emerson,Micheal,Bruce,Terry,Melvin,Leonel,Carl,Nelson,Moses,Isaias,Roy,Jermaine,Leon,Rodney,Kristian,Mohamed,Jeffery,Cyrus,Quincy,Nathanael,Tommy,Conor,Demetrius,Kendrick,Frederick,Terrance,Bobby,Jamison,Jon,Rohan,Kieran,Tobias,Ari,Felipe,Kenny,Jessie,Alonzo,Waylon,Malcolm,Emmett,Abram,Julien,Tomas,Allan,Terrell,Matteo,Reginald,Brent,Ahmad,Rene,Willie,Billy,Marlon,Jamal,Ariel,Joey,Rogelio,Ahmed,Dominik,Brendon,Toby,Marquis,Alfonso,Branden,Craig,Ibrahim,Osvaldo,Harley,Steve,Deshawn,Damion,Aron,Gerald,Rolando,Terrence,Enzo,Barrett,Ben,Blaine,Jerome,Muhammad,Ronnie,Leonard,Vicente,Alessandro,Zachery,Raphael,Rudy,Darrell,Elisha,Alvaro,Valentin,Harry,Rashad,Mohammed,Ramiro,Cedric,Santino,Stanley,Tyrone,Francis,Johnathon,Alonso,Gilberto,Luciano,Aryan,Jamie,Rhett,Rodolfo,Markus,Deven,Mohammad,Moshe,Dwayne,Eugene,Antoine,Wayne,Randall,Freddy,Neil,Brice,Elvis,Dexter,Heath,Duncan,Irvin,Gilbert,Keenan,Darnell,Adolfo,Harold,Agustin,Lamar,Emery,Devan,Seamus,Efrain,Darryl,Arjun,Mike,Roland,Conrad,Hamza,Frankie,Dominique,Vance,Todd,Luka,Rory,Alfred,Ernest,Hassan,Augustus,Ellis,Yusuf,Bruno,Humberto,Josh,Kasey,Winston,Matias,Sidney,Ignacio,Nigel,Addison,Deon,Anton,Marcel,Dale,Jordon,Ross,Clay,Dario,Ishaan,Glenn,Octavio,Ralph,Nikhil,Rayan,Zack,Nick,Salvatore,Jarrett,Antony,Eden,Howard,Ayaan,Leandro,Royce,Yael,Yosef,Alden,Aarav,Milton,Roderick,Clarence,Bernard,Reynaldo,Gordon,Reuben,Sheldon,Abdullah,Thaddeus,Lamont,Andreas,Arnav,Brenton,Sammy,Cornelius,Pierre,Fletcher,Hugh".split(",");
    #lastnames = "Smith,Johnson,Williams,Jones,Miller,Davis,Garcia,Rodriguez,Wilson,Martinez,Anderson,Hernandez,Moore,Jackson,Thompson,Lopez,Gonzalez,Harris,Clark,Lewis,Robinson,Walker,Perez,Sanchez,Wright,Adams,Ramirez,Campbell,Roberts,Carter,Phillips,Evans,Turner,Torres,Parker,Collins,Edwards,Flores,Morris,Nguyen,Murphy,Rivera,Rogers,Peterson,Cooper,Bailey,Gomez,Cox,Diaz,Richardson,Brooks,Bennett,Reyes,Cruz,Hughes,Foster,Sanders,Morales,Powell,Sullivan,Ortiz,Jenkins,Gutierrez,Perry,Barnes,Henderson,Coleman,Simmons,Patterson,Gonzales,Ramos,Hayes,Chavez,Bryant,Murray,Mcdonald,Ruiz,Kennedy,Alvarez,Castillo,Vasquez,Jimenez,Wagner,Romero,Robertson,Meyer,Moreno,Schmidt,Patel,Herrera,Fernandez,Tran,Hansen,Castro,Johnston,Aguilar,Silva,Chapman,Garza,Vargas,Guzman,Munoz,Obrien,Lynch,Mendez,Jensen,Weber,Soto,Chen,Walsh,Schneider,Wong,Santos,Delgado,Pena,Ortega,Estrada,Contreras,Nunez,Becker,Cohen,Mcdaniel,Vazquez,Dominguez,Mccarthy,Klein,Espinoza,Acosta,Oconnor,Navarro,Moss,Mclaughlin,Rojas,Singh,Yang,Goodman,Christensen,Molina,Fischer,Chang,Gallagher,Mejia,Ayala,Schroeder,Chan,Clarke,Bauer,Pham,Li,Olsen,Velasquez,Meyers,Fuentes,Weiss,Petersen,Serrano,Calderon,Rivas,Larsen,Oneill,Salas,Russo,Liu,Mcdowell,Suarez,Khan,Wu,Macdonald,Huang,Santana,Valenzuela,Berger,Escobar,Rocha,Mora,Nielsen,Huynh,Mayer,Friedman,Sosa,Huber,Rubio,Chung,Choi,Nixon,Rasmussen,Novak,Costa,Andersen,Benitez,Zhang,Davies,Duarte,Cooke".split(",");
    
    #sentenceTemplates = [
        "<salutation>! I have a <booking> for <name> at <time>",
        "<salutation>, I am <name> and there should be a <booking> for <numpeople> at <time>",
        "I have a <booking> under the name <name>",
        "<salutation>! There should be a <booking> for <numpeople> people at <time>",
        "I booked a table for <numpeople> at <time>. The <booking> is under the name <name>",
        "Can you please check if there is a <booking> for <name>?",
        "I booked a table at <time> for <numpeople> people",
        "<salutation>, my name is <name>. I have a <booking> for <numpeople> persons",
        "I have a <booking> for <numpeople>. This is the first time I come here",
        "I'll repeat a second time, my <booking> is under the name <name> at <time> for <numpeople>"
    ];

    constructor(guiManager, nSentences, maxMark){
        this._guiManager = guiManager;
        //this._simulationRunning = false;
        this._nSentences = nSentences;
        this._maxMark = maxMark;
        this._simulationRan = false;
    }

    getRandomSalutation(){
        let salutations = [
            'Hi', 'Hello', 'Good day', 'Good afternoon', 'Hello there'
        ];

        return salutations[Math.floor(Math.random() * salutations.length)];
    }

    getRandomBooking(){
        let booking = [
            'booking', 'reservation'
        ]

        return booking[Math.floor(Math.random() * booking.length)];
    }

    getRandomName() {
        const isMale = Math.floor(Math.random() * 2);
        const hasLastname = Math.floor(Math.random() * 2);
        let items;
        if (isMale){
            items = this.#maleNames;
        } else {
            items = this.#femaleNames;
        }
        let name = items[Math.floor(Math.random()*items.length)];

        if (hasLastname){
            let lastname = this.#lastnames[Math.floor(Math.random()*this.#lastnames.length)];
            name = `${name} ${lastname}`;
        }

        return name;
    }

    getRandomTime() {
        let hour = 1 + Math.floor(Math.random() * 12);
        let minutes = 15 * Math.floor(Math.random() * 4);
        if (minutes == 0){
            minutes = "00";
        }
        let isPm = "pm";
        if (hour >= 9 && hour <= 11){
            isPm = "am";
        }

        return `${hour}:${minutes}${isPm}`;
    }

    getRandomNumber() {
        let num = 2 + Math.floor(Math.random() * 7);
        let numArr = ["zero", "one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten"];
        return `${numArr[num]}`;
    }

    generateSentence() {
        const bookingName = this.getRandomName();
        const bookingNumber = this.getRandomNumber();
        const bookingTime = this.getRandomTime();

        let template = this.#sentenceTemplates[Math.floor(Math.random() * this.#sentenceTemplates.length)];
        let params = {bookingName: null, bookingTime: null, bookingNumber: null};

        if (template.includes("<name>")){
            params["bookingName"] = bookingName;
            template = template.replace("<name>", bookingName);
        }

        if (template.includes("<time>")){
            params["bookingTime"] = bookingTime;
            template = template.replace("<time>", bookingTime);
        }

        if (template.includes("<numpeople>")){
            params["bookingNumber"] = bookingNumber;
            template = template.replace("<numpeople>", bookingNumber);
        }

        if (template.includes('<salutation>')){
            template = template.replace('<salutation>', this.getRandomSalutation());
        }

        if (template.includes('<booking>')){
            template = template.replace('<booking>', this.getRandomBooking());
        }

        return {sentence: template, bookingParams: params};
    }

    initialiseGraphicElements(){
        let roboceptionist = new GraphicElement('roboceptionist', 'roboceptionist');
        roboceptionist.setElementPosition("25%", "50%");
        roboceptionist.setStatus("balloon", "Welcome! Press the button 'Run simulation' to start the simulation.")
        return [roboceptionist];
    }

    async runSimulation(evt){
        this._simulationRan = true;
        
        evt.currentTarget.innerHTML = "Reset task"
        let score = 0;
        for (let i = 0; i < this._nSentences; i++){
            
            let simItem = this.generateSentence();
            let sentence = simItem["sentence"];
            let params = simItem["bookingParams"];

            
            let output = parseBookingEnquiry(sentence);

            let isCorrect = false;
            if (typeof(output) === "object"){
                if (output["bookingName"] === params["bookingName"] && output["bookingTime"] === params["bookingTime"] && output["bookingNumber"] === params["bookingNumber"]){
                    isCorrect = true;
                }
            }

            if (isCorrect){
                score++;
            } else {
                this._guiManager.logError(`
                Error parsing the enquiry '${sentence}'. 
                Expected the object ${JSON.stringify(params)} 
                but got ${JSON.stringify(output)} instead.`
                );
            }
        }
        
        this._guiManager.logScore(`Correctly parsed enquiries ${score} of ${this._nSentences}.`);
        
        return score;
    }

    stopSimulation(evt) {
        location.reload();
    }

    handleEvent(evt){
        switch (evt.type){
            case 'click':
                let scoreElement = document.getElementById('score-scenario');
                if (this._simulationRan){
                    this.stopSimulation(evt);
                    
                } else {
                    scoreElement.innerHTML = "No score available";
                    let a = new Promise( (resolve) => {
                        let score = this.runSimulation(evt);
                        resolve(score);
                    }).then(
                        (result) => {
                            scoreElement.innerHTML = `
                            <h4>Task 1</h4>
                            ${result} correct parsed sentences out of ${this._nSentences} (${Math.round((result / this._nSentences)*100)}% success rate)<br />
                            `;
                        }
                    ).catch(
                        (err) => {
                            console.error(err);
                            this._guiManager.logError(err.stack);
                        }
                    );
                }
                break;
            default:
                return;
        }
    }
}

class Task2 {

    constructor(guiManager, maxMark){
        this._guiManager = guiManager;
        
        this._simulationRan = false;
        this._maxMark = maxMark;
        this._restaurant = new Restaurant();
        this._banner = document.createElement('div');
        this._banner.setAttribute('id', 'subtask-banner');
        this._banner.innerHTML = '';
        this._banner.style.display = 'none';
    }

    initialiseGraphicElements(){
        let tables = this._restaurant.getTables();
        let graphics = [];

        for (let i = 0; i < tables.length; i++){
            graphics.push(tables[i].getHTMLElement());
        }

        return graphics;
    }

    displayRobots(){
        let content = this._guiManager.getMainCanvas();
        let robots = this._restaurant.getRobots();
        let randTableNum = [];
        for (let i = 0; i < robots.length; i++){
            robots[i].resetRobot();
            robots[i].getHTMLElement().displayTo(content);

            let randNum;
            do{
                randNum = 1 + Math.floor(Math.random() * this._restaurant.getNumTables());
            } while(randTableNum.indexOf(randNum) !== -1);
            
            randTableNum.push(randNum);
            robots[i].moveToTable(this._restaurant.getTableByID(`table-${randNum}`));
        }
    }

    #sleep(ms){
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    async #popupBanner(subtaskTitle, message){
        this._banner.innerHTML = subtaskTitle
        this._banner.style.display = 'block';
        await this.#sleep(2000);
        this._banner.innerHTML = message;
        await this.#sleep(4000);
        this._banner.style.display = 'none';
    }

    async runSimulation(evt){
        
        this._simulationRan = true;
        let buttonSim = evt.currentTarget;
        buttonSim.innerHTML = "Reset task";
        let score = 0;
        
        let content = this._guiManager.getMainCanvas();
        content.appendChild(this._banner);
        let robots = this._restaurant.getRobots();

        // subtask a - move to empty table
        let targetTable;
        do{
            let randNum = 1 + Math.floor(Math.random() * this._restaurant.getNumTables());
            targetTable = this._restaurant.getTableByID(`table-${randNum}`);
        } while(targetTable.isAttended());

        let randRobotIdx = Math.floor(Math.random() * this._restaurant.getNumRobots());
        let randRobot = robots[randRobotIdx];

        await this.#popupBanner(
            'Initiating subtask (a)...',
            `Teleporting ${randRobot.getRobotID()} at unattended table ${targetTable.getTableID()}`
        );

        await safeTeleportTo(randRobot.getRobotID(), targetTable.getTableID());
        if (randRobot.whereIsRobot().getTableID() === targetTable.getTableID()){
            score++;
            this._guiManager.logScore("Subtask (a) successfully completed!");
        } else {
            this._guiManager.logError("Subtask (a) unsuccessful");
        }

        // subtask b - move to attended table with unacquired robot
        randRobotIdx = Math.floor(Math.random() * this._restaurant.getNumRobots());
        randRobot = robots[randRobotIdx];
        do{
            let randNum = 1 + Math.floor(Math.random() * this._restaurant.getNumTables());
            targetTable = this._restaurant.getTableByID(`table-${randNum}`);
        } while(!targetTable.isAttended() || targetTable.getTableID() === randRobot._curRobotTable.getTableID());

        await this.#popupBanner(
            'Initiating subtask (b)...',
            `Teleporting ${randRobot.getRobotID()} at attended table ${targetTable.getTableID()}`
        );

        await safeTeleportTo(randRobot.getRobotID(), targetTable.getTableID());
        if (randRobot.whereIsRobot().getTableID() === targetTable.getTableID()){
            score++;
            this._guiManager.logScore("Subtask (b) successfully completed!");
        } else {
            this._guiManager.logError("Subtask (b) unsuccessful");
        }

        randRobotIdx = Math.floor(Math.random() * this._restaurant.getNumRobots());
        randRobot = robots[randRobotIdx];
        do{
            let randNum = 1 + Math.floor(Math.random() * this._restaurant.getNumTables());
            targetTable = this._restaurant.getTableByID(`table-${randNum}`);
        } while(!targetTable.isAttended() || targetTable.getTableID() === randRobot._curRobotTable.getTableID());

        await this.#popupBanner(
            'Initiating subtask (c)...',
            `Teleporting ${randRobot.getRobotID()} at attended table ${targetTable.getTableID()} with robot currently busy`
        );

        let misplacedRobot = targetTable.getRobotAtTable();
        let token = await misplacedRobot.acquire();
        let promiseSleep = new Promise((resolve) => {
            setTimeout(() => {
                misplacedRobot.release(token);
                resolve(true);
            }, 4000 + Math.random() * 5000);
        });
        await safeTeleportTo(randRobot.getRobotID(), targetTable.getTableID());
        await promiseSleep;
        if (randRobot.whereIsRobot().getTableID() === targetTable.getTableID()){
            score++;
            this._guiManager.logScore("Subtask (c) successfully completed!");
        } else {
            this._guiManager.logError("Subtask (c) unsuccessful");
        }
        return score;
    }

    stopSimulation(evt) {
        location.reload();
    }

    handleEvent(evt){
        switch (evt.type){
            case 'click':
                let scoreElement = document.getElementById('score-scenario');
                if (this._simulationRan){
                    this.stopSimulation(evt);
                } else {
                    scoreElement.innerHTML = "No score available";
                    let a = new Promise( (resolve) => {
                        let score = this.runSimulation(evt);
                        resolve(score);
                    }).then(
                        (result) => {
                            scoreElement.innerHTML = `
                            <h4>Task 2</h4>
                            ${result} successful teleportations out of 3 (${Math.round((result / 6)*100)}% success rate)
                            `;
                        }
                    ).catch(
                        (err) => {
                            console.error(err);
                            this._guiManager.logError(err.stack);
                        }
                    );
                }
                break;
            default:
                return;
        }
    }
}

class Task3 {

    constructor (guiManager, maxMark){
        this._guiManager = guiManager;
        this._maxMark = maxMark;
        this._kitchen = new Kitchen(this._guiManager);
        this._simulationRan = false;
    }

    initialiseGraphicElements(){
        let stations = this._kitchen.getKitchenStations();
        let graphics = [];
        for (let i = 0; i < stations.length; i++){
            graphics.push(stations[i].getHTMLElement());
        }
        let chef = this._kitchen.getRobotChef();
        graphics.push(chef.getHTMLElement());
        let inventory = this._kitchen.getInventory();
        graphics.push(inventory);
        return graphics;
    }

    async runSimulation(evt){
        this._simulationRan = true;
        let buttonSim = evt.currentTarget;
        buttonSim.innerHTML = "Reset task"
        let score = 0;

        this._kitchen.startSensors();
        let orders = [];
        let ids = [];
        let levels = [
            'rare',
            'medium rare',
            'medium',
            'medium well',
            'well done'
        ];
        let sides = ['vegetables', 'mashed-potatoes'];
        for (let i = 1; i < 1000; i++){
            ids.push(i);
        }
        for (let i = 0; i < 6; i++){
            let curOrder = {
                'order-id': ids[Math.floor(Math.random()*ids.length)],
                'steak-level': levels[Math.floor(Math.random()*levels.length)],
                'side': sides[Math.floor(Math.random()*sides.length)]
            }
            orders.push(curOrder);
        }
        this._kitchen.setOrdersList(orders);

        await robotChef();

        let successOrders = await this._kitchen.getOrdersCompleted();
        this._kitchen.stopSensors();
        score = successOrders.length;
        return score;
    }

    stopSimulation(evt) {
        location.reload();
    }

    handleEvent(evt){
        switch (evt.type){
            case 'click':
                let scoreElement = document.getElementById('score-scenario');
                if (this._simulationRan){
                    this.stopSimulation(evt);
                } else {
                    scoreElement.innerHTML = "No score available";
                    let a = new Promise( (resolve) => {
                        let score = this.runSimulation(evt);
                        resolve(score);
                    }).then(
                        (result) => {
                            scoreElement.innerHTML = `
                            <h4>Task 3</h4>
                            ${result} successful orders out of 6 (${Math.round((result / 6)*100)}% success rate)
                            `;
                        }
                    ).catch(
                        (err) => {
                            console.error(err);
                            this._guiManager.logError(err.stack);
                        }
                    );
                }
                break;
            default:
                return;
        }
    }
}

class Assignment{

    #assetsURL = "assets/";
    #guiManager = new GUIManager();
    #requestGETParsed = false;
    #pageTask = "";
    #task1 = null;
    #task2 = null;
    #task3 = null;

    constructor(assetsURL){
        if (assetsURL)
            this.#assetsURL = assetsURL;
        this.#task1 = new Task1(this.#guiManager, 100, 3.25);
        this.#task2 = new Task2(this.#guiManager, 3.25);
        this.#task3 = new Task3(this.#guiManager, 3.5);
    }

    #getTask(taskID){
        switch (taskID){
            case 'task1':
                return this.#task1;
            case 'task2':
                return this.#task2;
            case 'task3':
                return this.#task3;
        }
    }

    #addCss(fileName){
        let head = document.head;
        let link = document.createElement("link");
        
        link.type = "text/css";
        link.rel = "stylesheet";
        link.href = fileName;
        
        head.appendChild(link);
    }

    loadIndexContent() {
        
        if (!this.#requestGETParsed){
            this.#requestGETParsed = true;
            this.#parseGETRequest();
        }
        
        switch (this.#pageTask){
            case 'task1':
                this.#initialiseTask(this.#pageTask, 'Task1 - Roboceptionist');
                break;
            case "task2":
                this.#initialiseTask(this.#pageTask, 'Task2 - Robot waiters');
                this.#task2.displayRobots();
                break;
            case "task3":
                this.#initialiseTask(this.#pageTask, 'Task3 - Robot chef');
                break;
            default:
                this.#pageTask = 'task1';
                this.#initialiseTask(this.#pageTask, 'Task1 - Roboceptionist');
        }
        
    }

    #getTaskID(){
        let url = new URL(window.location.href);
        let urlParams = new URLSearchParams(url.search);
        return urlParams.get('task');
    }

    #parseGETRequest() {
        this.#pageTask = this.#getTaskID();
    }

    #unselectedAllTaskLabels(){
        let elements = document.getElementsByClassName('test-label selected');
        for (let i = 0; i < elements.length; i++)
            elements[i].className = 'test-label';
    }

    #selectTaskLabel(taskID){
        this.#unselectedAllTaskLabels();
        document.getElementById(`test-label-${taskID}`).className = 'test-label selected';
    }

    #initialiseTask(taskID, taskTitle){
        let content = this.#guiManager.getMainCanvas();
        let buttonSim = this.#guiManager.getButtonSimulation();
        let titlePanel = this.#guiManager.getTitleDiv();
        this.#selectTaskLabel(taskID);
        titlePanel.innerHTML = taskTitle;
        this.#addCss(`assets/${taskID}.css`);
        let graphics = this.#getTask(`${taskID}`).initialiseGraphicElements();
        for (let i = 0; i < graphics.length; i++){
            graphics[i].displayTo(content);
        }
        buttonSim.addEventListener('click', this.#getTask(`${taskID}`));
    }

    task2Controller(){
        if (this.#getTaskID() === 'task2')
            return new RestaurantController(this.#task2._restaurant);
    }

    task3Controller(){
        if (this.#getTaskID() === 'task3')
            return new KitchenController(this.#task3._kitchen);
    }
}

const assignmentObj = new Assignment();

const restaurantController = assignmentObj.task2Controller();

const kitchenController = assignmentObj.task3Controller();

const log = (message) => {
    guiManager.log(message);
}